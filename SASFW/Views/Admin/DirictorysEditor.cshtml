<div id="app">
    <div class="layout-medium">
        <article class="hentry">


            <header class="entry-header">
                <h1 class="entry-title">Панель управления</h1>
            </header>


            <!-- .entry-content -->
            <div class="entry-content">
                <div class="row">



                    <!-- col 6/12 -->
                    <div class="col-sm-7">
                       


                        <h4>TOGGLES</h4>

                        <!-- .toggle-group -->
                        <div class="toggle-group">

                            <!-- .toggle -->
                            <div class="toggle">
                                <h4 class="">Plannig Your Design</h4>
                                <div class="toggle-content" style="display: none;">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.</div>
                            </div>
                            <!-- .toggle -->
                            <!-- .toggle -->
                            <div class="toggle">
                                <h4 class="">Building A Framework</h4>
                                <div class="toggle-content" style="display: none;">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.</div>
                            </div>
                            <!-- .toggle -->
                            <!-- .toggle opened on load -->
                            <!--<div class="toggle">
                                 <h4 class="active">UI/UX DEVELOPMENT</h4>
                                 <div class="toggle-content">This toggle content is shown on page load.</div>
                            </div>-->
                            <!-- .toggle -->

                        </div>
                        <!-- .toggle-group -->


                        <h4>Accordion</h4>

                        <!-- .accordion -->
                        <div class="toggle-group accordion">

                            <!-- .toggle -->
                            <div class="toggle">
                                <h4 class="">What To Do Next?</h4>
                                <div class="toggle-content" style="display: none;">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.</div>
                            </div>
                            <!-- .toggle -->
                            <!-- .toggle -->
                            <div class="toggle">
                                <h4 class="">Ok, But How?</h4>
                                <div class="toggle-content" style="display: none;">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.</div>
                            </div>
                            <!-- .toggle -->

                        </div>
                        <!-- .accordion -->
                        <!-- timeline -->
                        <div class="timeline">
                            <div v-for="(directoryModel, directoryIndex) in directoryModelsList">

                                <div class="event">
                                    <h2>{{directoryModel.directory.title}}</h2>
                                    <i class="pw-icon-bookmark-empty"></i>
                                    <p>
                                        <button v-on:click="removeDirectory(directoryModel,directoryIndex)">Удалить деррикторию</button>
                                    </p>
                                    <p>
                                        <!-- Button trigger modal -->
                                        <button type="button" v-on:click="currentDirectotyModel = directoryModelsList[directoryIndex]" class="button" data-toggle="modal" data-target="#editDirectoryModal">
                                            <i class="pw-icon-linkedin-squared"></i> Редактировать деррикторию
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="editDirectoryModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">Редактирование дерриктории</h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input type="text" v-model="currentDirectotyModel.directory.title" />
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Удалить</button>
                                                        <button type="button" v-on:click="updateDirectory(currentDirectotyModel)" class="btn btn-primary">Сохранить деррикторию</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </p>

                                    <div>
                                        <!-- Button trigger modal -->
                                        <button type="button" data-toggle="modal" data-target="#createDirectoryMaterialModal">
                                            Создать материал
                                        </button>
                                        <!-- Modal -->
                                        <div class="modal fade" id="createDirectoryMaterialModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">Создание материала</h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input type="text" v-model="directoryModel.newMaterialModel.title" />
                                                        <input type="text" v-model="directoryModel.newMaterialModel.category" />
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                                                        <button type="button" v v-on:click="createMaterial(directoryModel,directoryModel.newMaterialModel.title,directoryModel.newMaterialModel.category, directoryIndex)" class="btn btn-primary">Добавить материал</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div :class="dragging? 'list-dragging' : 'drag'" v-for="(category, categoryIndex) in directoryModel.categoryes">
                                    {{category.title}}
                                    <draggable :list="category.materials"  @@start="dragging=true" @@end="sortMaterials">
                                        <div v-for="(material, materialsIndex) in category.Materials">
                                            <div class="event" data-materialId="material.material.id">
                                                <span class="date">
                                                    {{material.material.lastDateUpdate}}
                                                </span>
                                                <h4>{{ material.material.title }}</h4>
                                                <h5>{{ category.title }}</h5>
                                                <p>
                                                    <button v-on:click="removeMaterial(directoryModel,material,directoryIndex,materialsIndex)">Удалить материал</button>
                                                </p>
                                            </div>
                                        </div>
                                    </draggable>
                                </div>

                            </div>
                        </div>
                        <!-- timeline -->

                        <p>
                            <!-- Button trigger modal -->
                            <button type="button" class="button" data-toggle="modal" data-target="#createDirectoryModal">
                                <i class="pw-icon-linkedin-squared"></i> Создать деррикторию
                            </button>
                            <!-- Modal -->
                            <div class="modal fade" id="createDirectoryModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Создание дерриктории</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <input type="text" v-model="newDirectoryModel.title" />
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                                            <button type="button" v-on:click="createDirectory(newDirectoryModel.title)" class="btn btn-primary">Добавить деррикторию</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p>


                    </div>
                    <!-- col 6/12 -->
                    <!-- col 6/12 -->
                    <div class="col-sm-5">

                        <h2 class="section-title">DEVELOPER SKILLS</h2>

                        <!-- DEV SKILLS -->
                        <div class="skillset">

                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>HTML5</h4>
                                <div class="bar" data-percent="80">
                                    <div class="progress" style="width: 80%;"><span>80</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->
                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>CSS3</h4>
                                <div class="bar" data-percent="95">
                                    <div class="progress" style="width: 95%;"><span>95</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->
                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>jQuery</h4>
                                <div class="bar" data-percent="80">
                                    <div class="progress" style="width: 80%;"><span>80</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->
                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>Wordpress</h4>
                                <div class="bar" data-percent="60">
                                    <div class="progress" style="width: 60%;"><span>60</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->

                        </div>
                        <!-- DEV SKILLS -->


                        <h2 class="section-title">DESIGNER SKILLS</h2>

                        <!-- DESIGN SKILLS -->
                        <div class="skillset">

                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>Fireworks</h4>
                                <div class="bar" data-percent="90">
                                    <div class="progress" style="width: 90%;"><span>90</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->
                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>Photoshop</h4>
                                <div class="bar" data-percent="70">
                                    <div class="progress" style="width: 70%;"><span>70</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->
                            <!-- .skill-unit -->
                            <div class="skill-unit">
                                <h4>Illustrator</h4>
                                <div class="bar" data-percent="50">
                                    <div class="progress" style="width: 50%;"><span>50</span></div>
                                </div>
                            </div>
                            <!-- .skill-unit -->

                        </div>
                        <!-- DESIGN SKILLS -->



                        <h2 class="section-title">TESTIMONIALS</h2>

                        <!-- testo-group -->
                        <div class="testo-group">

                            <!-- Testimonial -->
                            <div class="testo">
                                <img src="images/site/testo-03.jpg" alt="someone">
                                <h4>
                                    Vincent Wood
                                    <span>CEO / Gravity Inc.</span>
                                </h4>
                                <p>He is a great and hardworking guy. I am so proud of i have him as my asistant. He helped me so much. Also i am so proud of i have him as my asistant. He helped me so much.</p>

                            </div>
                            <!-- Testimonial -->
                            <!-- Testimonial -->
                            <div class="testo">
                                <img src="images/site/testo-02.jpg" alt="someone">

                                <h4>
                                    Gary Morgan
                                    <span>Chemist / Freelancer</span>
                                </h4>
                                <p>He was a great co-worker and a friend. I would't be where i am without his support.</p>

                            </div>
                            <!-- Testimonial -->
                            <!-- Testimonial -->
                            <div class="testo">
                                <img src="images/site/testo-01.jpg" alt="someone">

                                <h4>
                                    Jason Wilson
                                    <span>Lab Geek / Miami Metro</span>
                                </h4>
                                <p>He is ok. I don't really know him. He looks nice.</p>

                            </div>
                            <!-- Testimonial -->

                        </div>
                        <!-- testo-group -->

                    </div>
                    <!-- col 6/12 -->


                </div>
            </div>
        </article>

    </div>
</div>
<script src="https://unpkg.com/vue"></script>

<script type="text/javascript" src="~/Vue.Draggable/examples/libs/Sortable/Sortable.js"></script>
<script type="text/javascript" src="~/Vue.Draggable/dist/vuedraggable.min.js"></script>

@*<script type="text/javascript" src="script\main.js"></script>*@

<script>

    function directoryModelsListViewModel(directory, categotyes) {
        this.directory = directory;
        this.categoryes = categotyes;

        this.newMaterialModel = {
            title: '',
            category: ''
        }
    }

    function addNewMaterialModelToDirectoryModel(directory) { 
        directory.newMaterialModel = {
            title: '',
            category: ''
        }
        return directory;
    }

    function DirectoryCatagory(categoryTitle = '', categoryMaterials) {
        this.title = categoryTitle;
        this.materials = categoryMaterials
    }

    function MaterialViewModel(material) {
        this.material = material;
    }

    var app = new Vue({
        el: '#app',
        data: {
            directoryModelsList: [],
            dragging: false,

            newDirectoryModel: {
                title: ''
            },
            currentDirectotyModel: {
                directory: { title: ''}
                
            },
            currentMaterialModel: {
                title: '',
                category: ''
            },
        },
        methods: {
            
            loadData: function () {
                $.get("/Admin/getDirectoryesList", function (response) {
                    for (let i = 0; i < response.length; i++) {
                        addNewMaterialModelToDirectoryModel(response[i]);
                    }
                    app.directoryModelsList = response;
                }, "json");
            },
            clearDirectoryModal: function () {
                this.newDirectoryModel.title = '';
                this.newDirectoryModel.category = '';
            },
            clearMaterialModal: function (directoryIndex) {
                this.directoryModelsList[directoryIndex].newMaterialModel.title = '';
                this.directoryModelsList[directoryIndex].newMaterialModel.category = '';
            },

            createDirectory: function (newDirectoryModelText) {
                let _newDirectoryWithCategory = new directoryModelsListViewModel({ title: newDirectoryModelText }, [new DirectoryCatagory('', [])]);

                $.post("/Admin/saveDirectory", { directoryJson: JSON.stringify(_newDirectoryWithCategory) }, function (response, textStatus) {
                    if (textStatus == 'success') {
                        let _directoryViewModel = addNewMaterialModelToDirectoryModel(response);
                        app.directoryModelsList.push(_directoryViewModel);
                        $("#createDirectoryModal").modal('hide');
                        app.clearDirectoryModal();
                    }
                    else
                        alert(textStatus);
                }, "json");
            },
            saveDirectory: function (directory, index) {
                $.post("/Admin/saveDirectory", this.directoryModelsList[index], function (response, textStatus) {
                    if (textStatus == 'success') {
                        alert('success');
                    }
                    else
                        alert(textStatus);
                }, "json");
            },
            removeDirectory: function (directory, index) {
                $.post("/Admin/removeDirectory", { directoryJson: JSON.stringify(directory) }, function (response, textStatus) {
                    if (textStatus == 'success') {
                        this.directoryModelsList.splice(index, 1);
                    }
                    else
                        alert(textStatus);
                }, "json");
            },


            //#Materials
            createMaterial: function (directoryModel, title, category, directoryIndex) {

                let categoryIndex = this.directoryModelsList[directoryIndex].Categoryes.indexOf(
                    this.directoryModelsList[directoryIndex].Categoryes.filter(function (x) { return x.title == category; })[0]
                );
                let _newMaterial = new MaterialViewModel(
                    {
                        title: title,
                        directoryId: directoryIndex,
                        category: Category,
                        order: categoryIndex == -1 ? 1 : this.directoryModelsList[directoryIndex].categoryes[categoryIndex].materials.length
                    });

                $.post("/Admin/getDirectoryesList", _newDirectoryWithCategory, function (response, textStatus) {
                    if (textStatus == 'success') {
                        _newMaterial = response;
                    }
                    else
                        alert(textStatus);
                }, "json");

                if (categoryIndex == -1) {
                    this.directoryModelsList[directoryIndex].Categoryes.push(new DirectoryCatagory(category, [_newMaterial]));
                }
                else {
                    this.directoryModelsList[directoryIndex].categoryes[categoryIndex].materials.push(_newMaterial);
                }
                $("#createDirectoryMaterialModal").modal('hide');
                this.clearMaterialModal(directoryIndex);
            },
            
            removeMaterial: function (directory, material, directoryIndex, categoryIndex, materialsIndex) {
                $.post("/Admin/removeMaterial", material, function (response, textStatus) {
                    if (textStatus == 'success') {
                        this.directoryModelsList[directoryIndex].categoryes[categoryIndex].materials.splice(materialsIndex, 1);
                        if (this.directoryModelsList[directoryIndex].categoryes[categoryIndex].materials.length == 0) {
                            this.directoryModelsList[directoryIndex].Categoryes.splice(categoryIndex, 1);
                        }
                    }
                    else
                        alert(textStatus);
                }, "json");
            },
            sortMaterials: function (evt) {
                dragging = false;

                let _fromMaterial = evt.oldIndex;
                let _toMaterial = evt.newIndex;

                let itemEl = evt.item;  // dragged HTMLElement
             },
            

        }
    })
    $(document).ready(function () {
        app.loadData();
    })

</script>
